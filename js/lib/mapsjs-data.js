(function(ns){var H = ns;var k=this;function l(a,b){var c=a.split("."),d=k;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var f;c.length&&(f=c.shift());)c.length||void 0===b?d=d[f]?d[f]:d[f]={}:d[f]=b};function m(a){this.url=a;this.i=[];this.b=null;this.o=H.lang.bind(this.o,this);H.util.EventTarget.call(this)}H.lang.inherits(m,H.util.EventTarget);l("H.data.AbstractReader",m);var p={ERROR:-1,LOADING:0,VISIT:1,READY:2};m.State=p;m.prototype.state=p.READY;m.prototype.Q={R:"statechange"};m.prototype.X=function(){var a;this.b||(this.b=new H.map.provider.LocalObjectProvider,a=this.b.getRootGroup(),a.addObjects(this.i));return new H.map.layer.ObjectLayer(this.b)};m.prototype.getLayer=m.prototype.X;
m.prototype.Y=function(){return this.i.concat([])};m.prototype.getParsedObjects=m.prototype.Y;m.prototype.Z=function(){return this.url};m.prototype.getUrl=m.prototype.Z;m.prototype.fa=function(a){if(this.state===p.LOADING||this.state===p.VISIT)throw Error("InvalidState: state "+this.state);this.i=[];this.b=null;this.url=a;return this};m.prototype.setUrl=m.prototype.fa;m.prototype.getState=function(){return this.state};m.prototype.getState=m.prototype.getState;
function q(a,b,c,d){a.state=b;a.dispatchEvent(new r(c||a,a.Q.R,b,d||""))}m.prototype.parse=function(){var a=this;q(this,p.LOADING);new H.net.Xhr(this.url,function(b,c){c?q(a,p.ERROR,null,"Error loading file"):a.o(b)})};m.prototype.parse=m.prototype.parse;function r(a,b,c,d){H.util.getSuperProto(r).constructor.call(this,b,a);this.state=c;this.message=d}H.lang.inherits(r,H.util.Event);function s(a){this.D=a}
s.prototype.create=function(a,b){var c,d;switch(a.type){case "Point":c=new H.map.Marker(t(a.coordinates));break;case "LineString":c=new H.map.Polyline(u(a.coordinates));break;case "Polygon":c=new H.map.Polygon(u(a.coordinates[0]));break;case "MultiPoint":var f=c=new H.map.Group;d=a.coordinates;for(var e=0,h=d.length,g;e<h;e++)g=new H.map.Marker(t(d[e])),f.addObject(g);d="multiPoint";break;case "MultiLineString":f=c=new H.map.Group;d=a.coordinates;e=0;for(h=d.length;e<h;e++)g=new H.map.Polyline(u(d[e])),
f.addObject(g);d="multiLineString";break;case "MultiPolygon":f=c=new H.map.Group;d=a.coordinates;e=0;for(h=d.length;e<h;e++)g=new H.map.Polygon(u(d[e][0])),f.addObject(g);d="multiPolygon";break;case "GeometryCollection":f=c=new H.map.Group;d=a.geometries;e=0;for(h=d.length;e<h;e++)this.create(d[e],f);d="geometryCollection"}c&&(f=a.properties,e={},f&&(e.properties=f),d&&(e[d]=!0),c.setData(e),this.D(c));b&&c&&b.addObject(c);return c};l("H.data.geojson.ObjectFactory.prototype.create",s.prototype.create);
function t(a){return new H.geo.Point(a[1],a[0])}function u(a){for(var b=0,c=a.length,d=new H.geo.Strip;b<c;b++)d.pushPoint(t(a[b]));return d};function v(a,b){this.D=(b||{}).style||this.U;m.call(this,a)}H.lang.inherits(v,m);l("H.data.geojson.Reader",v);
v.prototype.o=function(a){var b,c,d,f,e;try{if(b=JSON.parse(a),"object"===typeof b){c=new s(this.D);switch(b.type){case "FeatureCollection":if(e=b.features)for(f=new H.map.Group,this.f(f),a=0;a<e.length;a++)d=w(e[a]),(d=c.create(d))&&f.addObject(d);break;case "Feature":d=w(b);(d=c.create(d))&&this.f(d);break;default:(d=c.create(b))&&this.f(d)}q(this,p.READY)}else q(this,p.ERROR,void 0,"Invalid syntax")}catch(h){q(this,p.ERROR,void 0,"Parse error. "+h.message)}};v.prototype.U=function(){};
function w(a){var b,c={};a.geometry&&a.properties&&(b=a.geometry,c.type=b.type,c.properties=a.properties,b.coordinates&&(c.coordinates=b.coordinates),b.geometries&&(c.geometries=b.geometries));return c}v.prototype.f=function(a){this.b&&this.b.getRootGroup().addObject(a);this.i.push(a);q(this,p.VISIT,a)};function x(a){a=a.attributes;for(var b,c=a.length;c--;)switch(b=a[c],b.name){case "x":this.x=parseFloat(b.value);break;case "y":this.y=parseFloat(b.value);break;case "xunits":this.c="fraction"===y.prototype.a(b);break;case "yunits":this.d="fraction"===y.prototype.a(b)}}l("H.data.kml.HotSpot",x);function A(a){var b=a.childNodes,c,d=new y;this.offsetX=this.offsetY=0;for(a=b.length;a--;)switch(c=b[a],c.nodeName){case "href":this.href=d.a(c)}}l("H.data.kml.Icon",A);function y(){}l("H.data.utils.Dom",y);y.prototype.j=function(a){return/^1$|^true$/.test(this.a(a))};y.prototype.getBoolean=y.prototype.j;y.prototype.a=function(a){try{var b="",c=0,d=a.childNodes,f=d.length;if(2===a.nodeType)return a.value;for(;c<f;c++)b+=d[c].nodeValue.replace(/^\s+|\s+$/g,"")}catch(e){}return b||""};y.prototype.getString=y.prototype.a;y.prototype.u=function(a){return parseFloat(this.a(a))||0};y.prototype.getFloat=y.prototype.u;
y.prototype.K=function(a){var b=a.split(/\s+/),c=b.length,d=!(b&&1==c),f=d?1:3,e=[],h;d||(b=a.split(","),c=b.length);for(h=0;h<c;h+=f)if(a=this.B(d?b[h]:h+3>b.length?null:b.slice(h,h+3)))e.push(a);else return[];return e};y.prototype.parseCoords=y.prototype.K;y.prototype.B=function(a){if(!a)return null;var b=a instanceof Array&&0<a.length&&4>a.length?a:a.split(",");a=parseFloat(b[0]);var c=parseFloat(b[1]),b=parseFloat(b[2]);return isNaN(c)||isNaN(a)?null:new H.geo.Point(c,a,isNaN(b)?void 0:b)};
y.prototype.parseCoord=y.prototype.B;y.prototype.p=function(a){a=this.a(a);return/^[0-9a-fA-F]{8}$/.test(a)?"#"+a.substr(6,2)+a.substr(4,2)+a.substr(2,2)+a.substr(0,2):"#000000ff"};y.prototype.getColor=y.prototype.p;function B(a){if(a){a=a.childNodes;for(var b,c=a.length,d=new y;c--;)switch(b=a[c],b.nodeName){case "scale":this.scale=d.u(b);break;case "Icon":if(b=new A(b))this.icon=b;break;case "hotSpot":this.G=new x(b)}}}l("H.data.kml.IconStyle",B);function C(){this.$={4:function(a){return["#",a.charAt(1),a.charAt(1),a.charAt(2),a.charAt(2),a.charAt(3),a.charAt(3),"ff"].join("")},5:function(a){return["#",a.charAt(1),a.charAt(1),a.charAt(2),a.charAt(2),a.charAt(3),a.charAt(3),a.charAt(4),a.charAt(4)].join("")},7:function(a){return a+"ff"},9:function(a){return a}};this.ea={4:function(a){return[D(a.charAt(1)),D(a.charAt(2)),D(a.charAt(3)),255]},5:function(a){return[D(a.charAt(1)),D(a.charAt(2)),D(a.charAt(3)),D(a.charAt(4))]},7:function(a){a=parseInt(a.substring(1),
16);return[a>>16&255,a>>8&255,a&255,255]},9:function(a){a=parseInt(a.substring(1),16);return[a>>24&255,a>>16&255,a>>8&255,a&255]}}}l("H.data.utils.ColorHelper",C);function D(a){a=parseInt(a,16);return(a<<4)+a}function E(a){return 16>a?"0"+Math.round(a).toString(16):Math.round(a).toString(16)}
function F(a,b,c){if(!/^(#|rgb).*/.test(b))return[0,0,0,255];c||(c="","#"===b.charAt(0)?c=a.$[b.length]?b:"":"rgb"===b.substr(0,3)&&(b=b.match(/\d+(\.\d+)?/g),c=b.length,c=2<c&&5>c?["#",E(+b[0]),E(+b[1]),E(+b[2]),3<c?E(255*+b[3]):"ff"].join(""):""),b=c);a=a.ea[b.length](b);a[3]=Math.round(a[3]/255*100)/100;return a}
C.prototype.P=function(a,b){var c,d="";if(!/^(#|rgb).*/.test(a)){c="";for(d=0;6>d;d++)c+="ABCDEF0123456789".charAt(Math.floor(16*Math.random()));return c+"ff"}c=F(this,a,b);for(var f=0;4>f;f++)d+=""+E(3>f?Math.floor(Math.random()*(c[f]-0+1))+0:255*c[f]);return d};C.prototype.toRandomRGBA=C.prototype.P;function G(a){a=a.childNodes;for(var b,c=a.length,d=new y;c--;)switch(b=a[c],b.nodeName){case "bgColor":this.bgColor=d.p(b);break;case "textColor":d.p(b);break;case "text":this.text=d.a(b);break;case "displayMode":d.a(b)}}l("H.data.kml.BalloonStyle",G);function I(a){a=a.childNodes;for(var b,c=a.length,d=new y,f=new C;c--;)switch(b=a[c],b.nodeName){case "color":this.color=d.p(b);break;case "colorMode":this.T=d.a(b)}"random"===this.T&&(this.color="#"+f.P(this.color,!1))}l("H.data.kml.ColorStyle",I);function J(a){var b=a.childNodes,c=b.length,d=new y;this.outline=this.fill=!0;for(this.n=new I(a);c--;)switch(a=b[c],a.nodeName){case "fill":this.fill=d.j(a);break;case "outline":this.outline=d.j(a)}}l("H.data.kml.PolyStyle",J);function K(a){var b=a.childNodes,c=b.length,d=new y;for(this.n=new I(a);c--;)a=b[c],"width"===a.nodeName&&(this.width=d.u(a))}l("H.data.kml.LineStyle",K);function L(a){var b=a.childNodes,c=b.length;for(this.id=a.getAttribute("id");c--;)switch(a=b[c],a.nodeName){case "IconStyle":if(a=new B(a))this.H=a;break;case "LineStyle":if(a=new K(a))this.q=a;break;case "PolyStyle":if(a=new J(a))this.M=a;break;case "BalloonStyle":if(a=new G(a))this.m=a}}l("H.data.kml.Style",L);function N(){this.O={}}l("H.data.kml.StyleContainer",N);N.prototype.s=function(a){a&&a.id&&(this.O["style_"+a.id]=a)};N.prototype.addStyle=N.prototype.s;N.prototype.v=function(a,b){var c=this.O["style_"+a];c instanceof O&&(c=c.getStyle(b));return c};N.prototype.getStyleById=N.prototype.v;function P(a,b){var c=a&&a.childNodes||[],d,f,e=new y;if(!a||!b)throw Error("Node or stylesContainer is not defined");this.visibility=!0;this.da=a;for(f=c.length;f--;)switch(d=c[f],d.nodeName){case "name":this.name=e.a(d);break;case "description":this.description=e.a(d);break;case "visibility":this.visibility=e.j(d);break;case "open":this.open=e.j(d);break;case "styleUrl":if(this.l=e.a(d))d=this.l.substr(1),this.W=b.v(d,!1);break;case "Style":if(d=new L(d))this.J=d}}l("H.data.kml.Feature",P);function Q(a,b){var c=a.childNodes,d,f=c.length,e=new y;for(this.k=b;f--;)switch(d=c[f],d.nodeName){case "key":this.key=e.a(d);break;case "styleUrl":this.l=e.a(d)}}l("H.data.kml.Pair",Q);Q.prototype.getStyle=function(){var a;this.l&&(a="highlight"===this.key?!0:!1,a=this.k.v(this.l.substr(1),a));return a};Q.prototype.getStyle=Q.prototype.getStyle;function O(a,b){var c=a.childNodes,d,f=c.length;this.k=b;this.id=a.getAttribute("id");for(this.r=[];f--;)d=c[f],"Pair"===d.nodeName&&(d=new Q(d,this.k))&&this.r.push(d)}l("H.data.kml.StyleMap",O);O.prototype.getStyle=function(a){var b=null;a=a?"highlight":"normal";for(var c=this.r.length;c--;)this.r[c].key===a&&(b=this.r[c].getStyle());return b};O.prototype.getStyle=O.prototype.getStyle;function R(a){a=a.childNodes;for(var b,c=a.length,d=null,f=new y;c--;)b=a[c],"coordinates"===b.nodeName&&(d=f.a(b));this.I=null;d&&(this.I=f.B(d)||null)}l("H.data.kml.Point",R);R.prototype.e=function(){return this.I};function S(a){a=a.childNodes;var b,c=a.length,d,f;for(this.F=new H.geo.Strip;c--;)if(b=a[c],"outerBoundaryIs"===b.nodeName)for(f=b.childNodes,b=f.length;b--;)d=f[b],"LinearRing"==d.nodeName&&(d=new T(d),this.F=d.e())}l("H.data.kml.Polygon",S);S.prototype.e=function(){return this.F};function T(a){a=a.childNodes;for(var b,c=a.length,d=new y;c--;)if(b=a[c],"coordinates"===b.nodeName){b=d.a(b);var f=[],e=new y;try{f=e.K(b)}catch(h){f=[]}this.t=2>f.length?[]:f}}l("H.data.kml.Line",T);T.prototype.e=function(){for(var a=new H.geo.Strip,b=this.t?this.t.length:0;b--;)a.pushPoint(this.t[b]);return a};function U(a,b){var c=document.createElement("CANVAS");c.width=1;c.height=1;this.k=a;this.A={};this.C={};this.V=new H.map.Icon(c);this.S=b||""}U.prototype.create=function(a){this.g=new P(a,this.k);return V(this,a,null)};
function V(a,b,c){var d;b=b.childNodes;for(var f=b.length,e,h={},g;f--;){d=b[f];switch(d.nodeName){case "Point":e=new R(d);g=W(a,"Marker");e=new H.map.Marker(e.e(),g);g.L&&H.util.events.listenOnce(g.L,"statechange",function(b,c){return function(){var d,e,f=c.anchor,g,h;e=c.href;var z=c.scale;this.getState()===H.map.Icon.prototype.State.READY&&(e=z+"_"+f.x+f.y+f.c+f.d+"_"+e,d=a.A[e],d||(g=f.x,h=f.y,d=this.getSize(),d={w:d.w*z,h:d.h*z},d=new H.map.Icon(this.getBitmap(),{anchor:{x:f.c?d.w*g:g*z,y:f.d?
d.h*(1-h):d.h-h*z},size:d}),a.A[e]=d,delete a.C[e]),b.setIcon(d))}}(e,g),!1);break;case "LineString":e=new T(d);g=W(a,"Polyline");e=new H.map.Polyline(e.e(),g);break;case "LinearRing":e=new T(d);g=W(a,"Polyline");e=new H.map.Polyline(e.e(),g);break;case "Polygon":e=new S(d);g=W(a,"Polygon");e=new H.map.Polygon(e.e(),g);break;case "MultiGeometry":e=new H.map.Group,e.multiGeometry=1,e=V(a,d,e)}e&&(a.g.name&&(h.name=a.g.name),a.g.description&&(h.description=a.g.description),g&&g.m&&(h.balloonStyle=g.m),
h.kmlNode=a.g.da,e.setData(h),c&&c.addObject(e))}c&&(e=c);return e}
function W(a,b){var c=a.g,d={visibility:c.visibility},f,e,h;f=new C;var g=1,n;e={x:0,y:0,c:!1,d:!1};var M;h=X(a,c.W);c.J&&(h=X(a,c.J,h));switch(b){case "Marker":h&&h.H&&(f=h.H,f.scale&&(g=f.scale),f.G&&(n=f.G,e={x:n.x,y:n.y,c:n.c,d:n.d}),f.icon&&f.icon.href?(c=f.icon.href,Y.test(c)||(c=a.S+c),f=g+"_"+e.x+e.y+e.c+e.d+"_"+c,M=H.map.Icon.prototype.State,n=a.A[f]||a.C[f],n||(n=new H.map.Icon(c),a.C[f]=n),n.getState()===M.LOADING?(d.icon=a.V,d.L=n,d.href=c,d.anchor=e,d.scale=g):n.getState()===M.READY&&
(d.icon=n)):1!==g&&(n||(e={x:14,y:4,c:!1,d:!1}),f=H.map.Icon,n={w:28*g,h:36*g},e={size:new H.math.Size(n.w,n.h),anchor:new H.math.Point(e.c?n.w*e.x:e.x*g,e.d?n.h*(1-e.y):n.h-e.y*g),hitArea:new H.map.HitArea(H.map.HitArea.ShapeType.POLYGON,[0*g,16*g,0*g,7*g,8*g,0*g,18*g,0*g,26*g,7*g,26*g,16*g,18*g,34*g,8*g,34*g])},d.icon=new f('<svg xmlns="http://www.w3.org/2000/svg" width="28px" height="36px"><path d="M 19 31 C 19 32.7 16.3 34 13 34 C 9.7 34 7 32.7 7 31 C 7 29.3 9.7 28 13 28 C 16.3 28 19 29.3 19 31 Z" fill="#000" fill-opacity=".2"/><path d="M 13 0 C 9.5 0 6.3 1.3 3.8 3.8 C 1.4 7.8 0 9.4 0 12.8 C 0 16.3 1.4 19.5 3.8 21.9 L 13 31 L 22.2 21.9 C 24.6 19.5 25.9 16.3 25.9 12.8 C 25.9 9.4 24.6 6.1 22.1 3.8 C 19.7 1.3 16.5 0 13 0 Z" fill="#fff"/><path d="M 13 2.2 C 6 2.2 2.3 7.2 2.1 12.8 C 2.1 16.1 3.1 18.4 5.2 20.5 L 13 28.2 L 20.8 20.5 C 22.9 18.4 23.8 16.2 23.8 12.8 C 23.6 7.07 20 2.2 13 2.2 Z" fill="#18d"/></svg>',
e)));break;case "Polyline":d.style={};h&&h.q&&(e=h.q,d.style.strokeColor="rgba("+F(f,e.n.color,!0)+")",0<=e.width&&(d.style.lineWidth=e.width));break;case "Polygon":d.style={},h&&(h.q&&(e=h.q,d.style.strokeColor="rgba("+F(f,e.n.color,!0)+")",0<=e.width&&(d.style.lineWidth=e.width)),h.M&&(e=h.M,d.style.fillColor=e.fill?"rgba("+F(f,e.n.color,!0)+")":"rgba(0,0,0,0)",e.outline||(d.style.lineWidth=0)))}d.m=h.m;return d}
function X(a,b,c){c=c||{};for(var d in b)b.hasOwnProperty(d)&&(c[d]="object"===typeof b[d]?X(a,b[d],c[d]):b[d]);return c}var Y=/^[^:\/]+:/;function Z(a){var b;this.N=[];m.call(this,a);b=a&&a.lastIndexOf("/");0<=b&&(this.aa=a.substr(0,b)+"/")}H.lang.inherits(Z,m);l("H.data.kml.Reader",Z);
Z.prototype.o=function(a){var b,c,d=null;if(a&&""!=a.trim()){try{c=(new DOMParser).parseFromString(a,"text/xml")}catch(f){q(this,p.ERROR,void 0,"Error parsing KML document");return}if(c.getElementsByTagName("parsererror").length)q(this,p.ERROR,void 0,"Error parsing KML document");else if((a=c.childNodes&&"kml"===c.childNodes[0].nodeName?c.childNodes[0]:void 0)&&(b=$(a.childNodes,"Document",!0)),b=b||a){c=new N;for(var e=$(b.childNodes,"Style"),h=$(b.childNodes,"StyleMap"),g=e.length;g--;)a=new L(e[g]),
c.s(a);for(g=h.length;g--;)a=new O(h[g],c),c.s(a);this.ga=c;this.ca=new U(this.ga,this.aa);a=b.childNodes;for(b=a.length;b--;)if(c=a[b],e=d,h=h=void 0,"Placemark"===c.nodeName?(h=this.ca.create(c))&&this.f(h,e):"Folder"===c.nodeName&&(h={group:new H.map.Group,ba:c},this.f(h.group,e),this.N.push(h)),!b&&(c=this.N.shift()))a=c.ba.childNodes,d=c.group,b=a.length;q(this,p.READY)}else q(this,p.ERROR,void 0,"Invalid KML document")}else q(this,p.ERROR,void 0,"Unable to create objects from the empty data")};
Z.prototype.f=function(a,b){b?b.addObject(a):(this.b&&this.b.getRootGroup().addObject(a),this.i.push(a),q(this,p.VISIT,a))};function $(a,b,c){for(var d=a.length,f,e=[];d--;)f=a[d],f.nodeName===b&&e.push(f);return c?e[0]:e};var H=H||{};l("H.data.buildInfo",function(){return H.util.BuildInfo.get("mapsjs-data","dev-0.6.1","c99bd95f5fb7c89a3d15c82c6e832357e600ab0b")});
}(H));//# sourceMappingURL=mapsjs-data.map